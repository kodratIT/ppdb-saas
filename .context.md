# PPDB SaaS - AI Coding Context

## Project Overview
**Project:** PPDB SaaS Platform (Penerimaan Peserta Didik Baru)
**Type:** Multi-tenant SaaS Application
**Duration:** 22 Weeks (06 Jan 2026 - 16 Jun 2026)
**Status:** Development Phase 1

---

## Tech Stack (Specific Versions)

### Frontend
- **Framework:** SvelteKit 2.x (App Router)
- **Language:** TypeScript 5.x
- **Styling:** Tailwind CSS 3.4.x
- **UI Components:** shadcn-svelte 0.3.x
- **Auth:** Firebase Authentication (latest)
- **State:** Svelte stores (built-in) + Zustand if needed
- **Forms:** SvelteKit native forms + Zod validation
- **HTTP:** Fetch API / SvelteKit load functions

### Backend
- **Runtime:** Cloudflare Workers
- **Framework:** Hono 4.x
- **Database:** Neon PostgreSQL (PostgreSQL 16)
- **ORM:** Drizzle ORM
- **Cache:** Cloudflare KV / D1
- **Storage:** Cloudflare R2
- **Auth:** Firebase Authentication (same as frontend)

### Infrastructure
- **Hosting:** Cloudflare Pages
- **Workers:** Cloudflare Workers
- **CI/CD:** GitHub Actions
- **Monitoring:** Cloudflare Analytics + Sentry
- **Payment:** Midtrans / Xendit

### Development Tools
- **Package Manager:** npm (or specify: pnpm)
- **Linter:** ESLint
- **Formatter:** Prettier
- **Version Control:** Git

---

## Coding Conventions

### File Structure
```
src/
├── lib/
│   ├── components/       # Reusable UI components
│   ├── stores/           # Svelte stores
│   ├── utils/            # Utility functions
│   ├── services/         # API calls
│   ├── types/            # TypeScript types
│   └── constants/        # Constants
├── routes/
│   ├── (public)/         # Public routes
│   ├── (auth)/           # Auth required
│   ├── (admin)/          # Admin only
│   └── api/              # API routes
├── hooks.server.ts       # Server hooks
└── app.html             # HTML template
```

### TypeScript
- Use strict mode: `"strict": true`
- Use interfaces for object shapes, types for unions/primitives
- Avoid `any` type
- Use proper generics
- Export types for reuse
- Use JSDoc comments for complex logic

### Svelte/SvelteKit
- Use `<script>` with `lang="ts"` for TypeScript
- Use `<script lang="ts" context="module">` for load functions
- Use `+page.svelte`, `+layout.svelte`, `+page.server.ts` pattern
- Prefer composition over nested components
- Use `$app/stores` for SvelteKit stores
- Use `let` for reactive variables
- Use `$:` for derived state
- Prefer named exports over default exports

### Tailwind CSS
- Use Tailwind classes for styling
- Follow mobile-first approach
- Use responsive prefixes (`md:`, `lg:`)
- Use utility classes over custom CSS
- Extract repeated patterns to component variants
- Use `@apply` sparingly, prefer inline classes

### API Design
- RESTful conventions
- Use `load()` functions for data fetching
- Use `+page.server.ts` for server-side data
- Use `+page.ts` for shared data
- Proper error handling with try/catch
- Type-safe API calls with Zod schemas
- Use environment variables for configuration

### Database (Drizzle)
- Use type-safe queries with Drizzle ORM
- Follow naming convention: snake_case for DB columns, camelCase for TS
- Use transactions for multi-table operations
- Index frequently queried columns
- Use prepared statements for performance

### Git & Commits
- Follow conventional commits: `feat:`, `fix:`, `refactor:`, `docs:`, `test:`, `chore:`
- Keep commits atomic
- Commit frequently
- Use descriptive commit messages
- Reference task IDs when applicable: `[FE-P1-01] Setup project`

### Error Handling
- Never expose sensitive data in errors
- Use proper HTTP status codes
- Log errors to monitoring (Sentry)
- Show user-friendly error messages
- Implement graceful degradation

### Security
- Never hardcode secrets or API keys
- Use environment variables for all secrets
- Implement CSRF protection
- Validate all user inputs (Zod)
- Use Firebase for authentication
- Sanitize user-generated content
- Implement rate limiting

---

## Architecture Decisions

### Multi-Tenancy
- **Tenant Resolution:** Subdomain-based (e.g., `school1.ppdb.com`)
- **Tenant Context:** Passed through headers in all API calls
- **Data Isolation:** Tenant ID column in all multi-tenant tables
- **Auth:** Global user accounts with tenant-specific roles

### Authentication & Authorization
- **Provider:** Firebase Authentication
- **Flow:** OAuth + email/password
- **SSO:** Multi-tenant SSO (one account, multiple schools)
- **Roles:** Super Admin, School Admin, Verifier, User
- **Authorization:** Middleware-based with role checks

### Data Flow
```
User Action → Component → Store/Service → API (Hono) → Business Logic → DB (Neon)
```

### State Management
- **Local State:** Component state (Svelte reactivity)
- **Global State:** Svelte stores for app-wide state
- **Server State:** SvelteKit `load()` functions
- **Cache:** KV/D1 for frequently accessed data

### Performance
- **Edge Computing:** Cloudflare Workers for API
- **Static Generation:** Use ISR where possible
- **Optimization:** Lazy loading, code splitting
- **CDN:** Cloudflare CDN for static assets
- **Caching:** KV/D1 caching for API responses

### Error Handling Strategy
- **Frontend:** Show user-friendly messages, log to Sentry
- **Backend:** Return proper HTTP codes, log with context
- **Database:** Transaction rollback on errors
- **API:** Consistent error response format

---

## Current Task in Progress

### Active Task
**Task ID:** [TBD - Update with current task]
**Task Name:** [TBD - Update with current task]
**Priority:** [TBD - Update with current task]
**Estimated Time:** [TBD - Update with current task]

### Task Description
[TBD - Paste task description from task file]

### Acceptance Criteria
- [ ] [TBD - Update with acceptance criteria]
- [ ] [TBD - Update with acceptance criteria]

### Status
- **Started:** [TBD - Date/Time]
- **In Progress:** Yes/No
- **Blocked:** No / [Reason if yes]
- **Notes:** [Any notes or blockers]

---

## Important Notes

### Multi-School Registration Rules
- Maximum 3 schools total per registration
- Maximum 1 public (negeri) school
- Validation must be enforced at both frontend and backend

### Registration Paths (Jalur PPDB)
1. **Zonasi** - Distance-based
2. **Prestasi** - Achievement-based
3. **Afirmasi** - Affirmation
4. **Mutasi** - Transfer
5. **Anak Guru** - Teacher's children
6. **Internal** - Internal transfer

### Payment Flow
- Midtrans / Xendit integration
- Generate payment token on registration
- Webhook for payment confirmation
- Timeout handling
- Retry logic for failed payments

### Testing Strategy
- Unit tests for business logic
- Integration tests for API
- E2E tests for critical flows
- Manual testing for UX

### Deployment Strategy
- Blue-green deployment
- Staging environment for UAT
- Canary releases for critical features
- Rollback plan ready

---

## Reference Documents
- **PRD:** `/docs/01. PRD-PPDB-SAAS.md`
- **TDD:** `/docs/02. TDD-PPDB-SAAS.md`
- **WBS:** `/docs/03. WBS-PPDB-SAAS.md`
- **Task Files:** `/tasks/task_[role].md`

---

## Quick Commands

### Development
```bash
npm run dev          # Start dev server
npm run build        # Build for production
npm run preview      # Preview production build
npm run test         # Run tests
npm run lint         # Run linter
npm run type-check   # TypeScript type checking
```

### Database
```bash
npm run db:push      # Push schema changes
npm run db:generate  # Generate migrations
npm run db:migrate   # Run migrations
```

### Git
```bash
git status
git add .
git commit -m "[FE-P1-01] Description"
git push
```

---

## Contact & Support
- **Technical Lead:** [Contact info]
- **Project Manager:** [Contact info]
- **Documentation:** See docs/ folder

---

*Last Updated: [Date/Time]*
*Context maintained by: [Your Name]*
