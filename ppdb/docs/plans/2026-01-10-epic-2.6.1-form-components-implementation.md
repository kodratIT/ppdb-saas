# Epic 2.6.1 Form Components Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Finalize reusable `Textarea` and `FormError` components and refactor admin settings forms to use them without changing behavior or payloads.

**Architecture:** Keep form UI components small and composable. `Textarea` mirrors `Input` styling and forwards props. `FormError` renders the first field error for server action validation. Admin pages import these components and keep action handlers/data flow unchanged.

**Tech Stack:** SvelteKit (Svelte 5), Tailwind CSS, Vitest, @testing-library/svelte.

---

### Task 1: Finalize `Textarea` component + unit test

**Files:**

- Modify: `ppdb/src/lib/components/ui/textarea.svelte`
- Modify: `ppdb/src/lib/components/ui/textarea.test.ts`

**Step 1: Write the failing test**

```ts
import { render, screen } from '@testing-library/svelte';
import Textarea from './textarea.svelte';

describe('Textarea', () => {
	it('renders with value and placeholder', () => {
		render(Textarea, {
			props: { value: 'Halo sekolah', placeholder: 'Masukkan deskripsi' }
		});

		const textarea = screen.getByPlaceholderText('Masukkan deskripsi') as HTMLTextAreaElement;
		expect(textarea.value).toBe('Halo sekolah');
	});
});
```

**Step 2: Run test to verify it fails**

Run: `yarn vitest src/lib/components/ui/textarea.test.ts -v`
Expected: FAIL if component props/bindings are incorrect

**Step 3: Write minimal implementation**

```svelte
<textarea
	class={cn(
		'flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',
		className
	)}
	bind:value
	{...restProps}
></textarea>
```

**Step 4: Run test to verify it passes**

Run: `yarn vitest src/lib/components/ui/textarea.test.ts -v`
Expected: PASS

**Step 5: Commit**

```bash
git add ppdb/src/lib/components/ui/textarea.svelte ppdb/src/lib/components/ui/textarea.test.ts
git commit -m "feat(ui): add textarea component"
```

---

### Task 2: Finalize `FormError` component + unit test

**Files:**

- Modify: `ppdb/src/lib/components/forms/form-error.svelte`
- Modify: `ppdb/src/lib/components/forms/form-error.test.ts`

**Step 1: Write the failing test**

```ts
import { render, screen } from '@testing-library/svelte';
import FormError from './form-error.svelte';

describe('FormError', () => {
	it('renders the first error for a field', () => {
		render(FormError, {
			props: { errors: { name: ['Nama wajib diisi'] }, field: 'name' }
		});

		expect(screen.getByText('Nama wajib diisi')).toBeInTheDocument();
	});

	it('renders nothing when no error exists', () => {
		const { container } = render(FormError, {
			props: { errors: {}, field: 'name' }
		});

		expect(container.firstChild).toBeNull();
	});
});
```

**Step 2: Run test to verify it fails**

Run: `yarn vitest src/lib/components/forms/form-error.test.ts -v`
Expected: FAIL if error handling or conditional render is wrong

**Step 3: Write minimal implementation**

```svelte
{#if errorMessage}
	<p class="text-red-500 text-sm mt-1">{errorMessage}</p>
{/if}
```

**Step 4: Run test to verify it passes**

Run: `yarn vitest src/lib/components/forms/form-error.test.ts -v`
Expected: PASS

**Step 5: Commit**

```bash
git add ppdb/src/lib/components/forms/form-error.svelte ppdb/src/lib/components/forms/form-error.test.ts
git commit -m "feat(ui): add form error helper"
```

---

### Task 3: Refactor School Profile form to use shared components

**Files:**

- Modify: `ppdb/src/routes/admin/settings/+page.svelte`

**Step 1: Write the failing test**

_No existing page-level tests. Skip automated test and rely on manual smoke checks._

**Step 2: Run test to verify it fails**

_Run existing unit tests if available; expect no change._

**Step 3: Write minimal implementation**

- Import `Textarea` + `FormError`.
- Replace raw `<textarea>` and repeated error markup with `<Textarea>` and `<FormError {errors} field="..." />`.
- Keep existing `name`, `id`, and `bind:value` attributes.

**Step 4: Run test to verify it passes**

Manual smoke check:

- Form values bind correctly.
- Errors render per-field.
- Styling matches existing inputs.

**Step 5: Commit**

```bash
git add ppdb/src/routes/admin/settings/+page.svelte
git commit -m "refactor(settings): reuse form components in school profile"
```

---

### Task 4: Refactor Admission Paths form to use shared components

**Files:**

- Modify: `ppdb/src/routes/admin/settings/admission-paths/+page.svelte`

**Step 1: Write the failing test**

_No existing tests for this page. Skip automated test and rely on manual checks._

**Step 2: Run test to verify it fails**

_Skip._

**Step 3: Write minimal implementation**

- Import `Textarea` for description fields in create/edit modals.
- Keep `Label` + `Input` usage consistent with other forms.

**Step 4: Run test to verify it passes**

Manual smoke check:

- Create/Edit modal opens and accepts input.
- Description field renders with shared styling.

**Step 5: Commit**

```bash
git add ppdb/src/routes/admin/settings/admission-paths/+page.svelte
git commit -m "refactor(settings): use textarea in admission paths"
```

---

### Task 5: Refactor Fee Structures form to use shared components

**Files:**

- Modify: `ppdb/src/routes/admin/settings/fee-structures/+page.svelte`

**Step 1: Write the failing test**

_No existing tests for this page. Skip automated test and rely on manual checks._

**Step 2: Run test to verify it fails**

_Skip._

**Step 3: Write minimal implementation**

- Import `Textarea` for description fields in create/edit modal.
- Use `FormError` if server action errors map to fields.
- Preserve action handlers and form payloads.

**Step 4: Run test to verify it passes**

Manual smoke check:

- Create/Edit modal fields render correctly.
- Errors still display properly after validation failure.

**Step 5: Commit**

```bash
git add ppdb/src/routes/admin/settings/fee-structures/+page.svelte
git commit -m "refactor(settings): reuse textarea in fee structures"
```

---

### Task 6: Refactor RBAC assignment form (School Admins)

**Files:**

- Modify: `ppdb/src/routes/admin/settings/school-admins/+page.svelte`

**Step 1: Write the failing test**

_No existing tests for this page. Skip automated test and rely on manual checks._

**Step 2: Run test to verify it fails**

_Skip._

**Step 3: Write minimal implementation**

- Ensure create form fields use shared `Input` + `Label` patterns consistently.
- Replace any `<textarea>` (if present) with `Textarea`.
- Keep form submission and role assignment unchanged.

**Step 4: Run test to verify it passes**

Manual smoke check:

- Invite form renders and submits.
- Role select works as before.

**Step 5: Commit**

```bash
git add ppdb/src/routes/admin/settings/school-admins/+page.svelte
git commit -m "refactor(settings): align school admins form components"
```

---

### Task 7: Clean working tree to Epic 2.6.1 scope

**Files:**

- Review: `ppdb/src/lib/components/ui/*`
- Review: `ppdb/src/app.css`
- Revert/Keep: non-2.6.1 changes (drizzle, tests, config)

**Step 1: Review scope**

Identify non-2.6.1 files and decide to revert or move to separate branch.

**Step 2: Revert unrelated changes**

Run: `git restore <path>` for files outside form components and settings pages.

**Step 3: Verify working tree**

Run: `git status -sb`
Expected: only 2.6.1-related files changed

**Step 4: Commit cleanup**

```bash
git add -A
git commit -m "chore: keep epic 2.6.1 changes scoped"
```

---

Plan complete and saved to `docs/plans/2026-01-10-epic-2.6.1-form-components-implementation.md`. Two execution options:

1. Subagent-Driven (this session) — I dispatch fresh subagent per task, review between tasks, fast iteration
2. Parallel Session (separate) — Open new session with executing-plans, batch execution with checkpoints

Which approach?
